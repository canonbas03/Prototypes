@{
    Layout = "_GuestLayout";
}
@model HotelMVCPrototype.Models.Room

<div class="room-title">
    <img src="/images/ornament.png" class="ornament left" alt="">
    <span class="room-text">Room @Model.Number</span>
    <img src="/images/ornament.png" class="ornament right" alt="">
</div>

<div class="card-collection">
    <a asp-action="Index" asp-controller="GuestOrders" asp-route-roomId="@Model.Id" class="room-card">
        <div class="card-inner">
            <img src="~/images/order-menu.png" alt="Food" class="card-image">

            <div class="card-text">
                Order Food & Drinks
            </div>
        </div>
    </a>

    <a asp-action="Index" asp-controller="GuestRequests" asp-route-roomId="@Model.Id" class="room-card">
        <div class="card-inner">
            <img src="~/images/request-service.png" alt="Services" class="card-image">

            <div class="card-text">
                Request Service
            </div>
        </div>
    </a>
</div>

<!-- DND Toggle -->
<div class="action-cards">
    <div class="dnd-card"
         id="dnd-card"
         data-room-id="@Model.Id"
         data-is-dnd="@Model.IsDND.ToString().ToLower()"
         role="button"
         tabindex="0">

        <div class="dnd-text">Do Not Disturb</div>
        <div class="dnd-status-text" id="dnd-status">
            @(Model.IsDND ? "ON" : "OFF")
        </div>
    </div>

    @* Change this *@
    <a asp-action="Index"
       asp-controller="GuestRequests"
       asp-route-roomId="@Model.Id"
       class="card-link">

        <div class="report-card">
            <div class="dnd-text">Report</div>
        </div>

    </a>
</div>

<button id="dnd-toggle-btn"
        class="btn @(Model.IsDND ? "btn-warning" : "btn-outline-secondary") btn-lg w-75"
        data-room-id="@Model.Id">
    @(Model.IsDND ? "🔕 Do Not Disturb: ON" : "🔔 Do Not Disturb: OFF")
</button>

<hr />

<!-- Centered hotel logo -->
<div class="text-center my-4">
    <img src="~/images/le-vins-logo.png" alt="Hotel Logo" style="height:60px;" />
    <h2 class="mt-2">Le' Vins</h2>
</div>

<!-- Room info card -->
<div class="card shadow-sm p-3 mb-4 mx-3">
    <h4>Room @Model.Number</h4>

    <!-- DND Toggle -->
    <div class="my-3 text-center">
        <button id="dnd-toggle-btn"
                class="btn @(Model.IsDND ? "btn-warning" : "btn-outline-secondary") btn-lg w-75"
                data-room-id="@Model.Id">
            @(Model.IsDND ? "🔕 Do Not Disturb: ON" : "🔔 Do Not Disturb: OFF")
        </button>
    </div>
</div>

<div class="card shadow-sm p-3 mb-4 mx-3">
    <h5>Set Room Status</h5>
    <div id="dnd-wrapper">
        <partial name="_DndToggle" model="Model" />
    </div>
</div>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        const card = document.getElementById("dnd-card");
        const statusText = document.getElementById("dnd-status");
        const cardInner = document.getElementById("dnd-card-inner");

        let isDnd = card.dataset.isDnd === "true";
        card.style.backgroundColor = isDnd ? "#FFC107" : "#E5E7EB";

        card.addEventListener("click", () => {
            const roomId = card.dataset.roomId;

            fetch(`/GuestRoom/ToggleDnd?roomId=${roomId}`, {
                method: "POST",
                headers: {
                    "RequestVerificationToken": document.querySelector('input[name="__RequestVerificationToken"]')?.value
                }
            })
            .then(res => res.text())
            .then(isDnd => {
                const enabled = isDnd === "true";

                statusText.textContent = enabled ? "ON" : "OFF";

                card.style.backgroundColor = enabled ? "#FFC107" : "#E5E7EB";
            });
        });
    });
</script>