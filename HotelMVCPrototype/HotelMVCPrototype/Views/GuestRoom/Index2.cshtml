@model HotelMVCPrototype.Models.Room

<div class="card shadow-sm mb-4 p-4">
    <h2 class="mb-3">Room @Model.Number</h2>

    <div class="mb-3">
        <h5>Set Room Status</h5>
        <div id="dnd-wrapper">
            <partial name="_DndToggle" model="Model" />
        </div>
    </div>

    <hr />

    <div class="d-grid gap-3">
        <a class="btn btn-primary btn-lg"
           asp-controller="GuestOrders"
           asp-action="Index"
           asp-route-roomId="@Model.Id">
            🍽 Order Food & Drinks
        </a>

        <a class="btn btn-secondary btn-lg"
           asp-controller="GuestRequests"
           asp-action="Index"
           asp-route-roomId="@Model.Id">
            🧹 Request Service
        </a>
    </div>
</div>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("dnd-toggle-btn");

        btn.addEventListener("click", () => {
            const roomId = btn.dataset.roomId;

            fetch(`/GuestRoom/ToggleDnd?roomId=${roomId}`, {
                method: "POST",
                headers: {
                    "RequestVerificationToken": document.querySelector('input[name="__RequestVerificationToken"]')?.value
                }
            })
            .then(r => r.text())
            .then(isDnd => {
                if (isDnd === "true") {
                    btn.classList.remove("btn-outline-secondary");
                    btn.classList.add("btn-warning");
                    btn.textContent = "Do Not Disturb: ON";
                } else {
                    btn.classList.remove("btn-warning");
                    btn.classList.add("btn-outline-secondary");
                    btn.textContent = "Do Not Disturb: OFF";
                }
            });
        });
    });
</script>

