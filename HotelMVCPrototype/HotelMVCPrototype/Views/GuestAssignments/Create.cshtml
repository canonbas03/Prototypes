@model CreateStayViewModel

<h2>New Check-In</h2>

<form asp-action="Create" method="post">
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

    <input type="hidden" asp-for="RoomId" />

    <div class="row mb-3">
        <div class="col">
            <label>Arrival</label>
            <input asp-for="CheckInDate" class="form-control" type="date" />
        </div>
        <div class="col">
            <label>Departure</label>
            <input asp-for="CheckOutDate" class="form-control" type="date" />
        </div>
    </div>

    <h5 class="mt-4">Guests</h5>

    @{
        var emptyGuest = new GuestInputViewModel();
    }

    <div id="guests">
        @if (Model.Guests.Any())
        {
            for (int i = 0; i < Model.Guests.Count; i++)
            {
                <partial name="_GuestInput" for="@Model.Guests[i]" />
            }
        }
        else
        {
            <partial name="_GuestInput" for="@emptyGuest" />
        }
    </div>

    <button type="button" id="addGuestBtn" class="btn btn-outline-secondary mt-2">
        + Add Guest
    </button>

    <button type="submit" class="btn btn-success mt-3">
        Check In
    </button>
</form>



<script>
        let guestIndex = @Model.Guests.Count; // Start from existing guests

    document.getElementById("addGuestBtn").addEventListener("click", () => {
        fetch('@Url.Action("GuestTemplate", "GuestAssignments")')
            .then(r => r.text())
            .then(html => {
                html = html.replace(/__index__/g, guestIndex);
                document.getElementById("guests").insertAdjacentHTML("beforeend", html);
                guestIndex++;
            });
    });

    document.addEventListener("click", function (e) {
        if (e.target.classList.contains("remove-guest")) {
            e.target.closest(".guest-card").remove();
        }
    });
</script>
